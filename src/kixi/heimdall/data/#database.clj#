(ns kixi.heimdall.data.database
  (:require [stuart.sierra.component :as component]
            [qbits.alia :as alia]
            [taoensso.timbre :as timbre]))

(defrecord Database [host port connection]
  component/Lifecycle

  (start [component]
    (timbre/info ";; Starting database")
    (assert (and cluster keyspace) "cluster and/or keyspace cannot be nil")    
    (let [cluster (alia/cluster {:contact-points ["localhost"]})
          session ]
      ;; Return an updated version of the component with
      ;; the run-time state assoc'd in.
      (assoc component :connection conn)))

  (stop [component]
    (timbre/info ";; Stopping database")
    ;; In the 'stop' method, shut down the running
    ;; component and release any external resources it has
    ;; acquired.
    (.close connection)
    ;; Return the component, optionally modified. Remember that if you
    ;; dissoc one of a record's base fields, you get a plain map.
    (assoc component :connection nil)))
